{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="space-y-12 md:space-y-24">

  <!-- âœ… Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
  {% if welcome_popup and welcome_popup.is_active %}
  <div id="welcome-popup"
       class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center transition-opacity p-4">
    <div onclick="event.stopPropagation()"
         class="bg-white rounded-xl p-6 max-w-md w-full text-center relative shadow-2xl animate-fade-in">

      <!-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ -->
      <button onclick="closeWelcomePopup()"
              class="absolute top-3 left-3 text-gray-400 hover:text-red-600 text-2xl transition">
        &times;
      </button>

      {% if welcome_popup.image %}
      <img src="{{ welcome_popup.image.url }}"
           alt="{{ welcome_popup.title }}"
           class="rounded-lg mb-4 mx-auto max-h-60 object-contain shadow" />
      {% endif %}

      <h3 class="text-xl md:text-2xl font-bold text-blue-700 mb-3">{{ welcome_popup.title }}</h3>
      <p class="text-gray-700 whitespace-pre-line leading-relaxed text-sm md:text-base">{{ welcome_popup.message }}</p>
    </div>
  </div>
  {% endif %}

  <!-- ğŸŸ¦ ØªØ±Ø­ÙŠØ¨ -->
  <section class="bg-gradient-to-br from-blue-50 to-white text-center py-12 md:py-20 px-4 sm:px-8 rounded-xl shadow-md">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-3xl md:text-5xl font-extrabold text-gray-800 mb-4 animate-fade-up">
        Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ <span class="text-blue-600">Ù…Ù†ØµØ© Ø£Ù‡Ø§Ù„ÙŠ Ø§Ù„Ø­ÙŠ</span> ğŸ‘‹
      </h1>
      <p class="text-base md:text-lg text-gray-600 mb-8 leading-relaxed">
        Ù…Ù†ØµØ© Ù…Ø®ØµØµØ© Ù„Ø£Ù‡Ø§Ù„ÙŠ Ø­ÙŠ <strong class="text-blue-700">ØªÙ†Ø§Ù„</strong> Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ù…Ø­Ù„ÙŠØ©ØŒ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ÙŠØ©.
      </p>
      <div class="flex flex-col sm:flex-row justify-center gap-4">
        {% if not user.is_authenticated %}
        <a href="{% url 'login' %}"
           class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition flex items-center justify-center gap-2">
          <span>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
        </a>
        {% endif %}
        <a href="{% url 'public_store_browser' %}"
           class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg shadow-md hover:shadow-lg transition flex items-center justify-center gap-2">
          <span>ğŸ›ï¸ Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù†</span>
        </a>
      </div>
    </div>
  </section>

  <!-- ğŸ’¡ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª -->
  <section id="features" class="max-w-7xl mx-auto px-4 sm:px-6">
    <h2 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-8 md:mb-12">âœ¨ Ù…Ø§Ø°Ø§ ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ù†ØµØ©ØŸ</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <div class="bg-white p-6 rounded-2xl shadow-md hover:shadow-lg transition transform hover:-translate-y-1">
        <h3 class="text-xl font-semibold text-gray-800 mb-2">ğŸ›’ Ù…ØªØ§Ø¬Ø± Ù‚Ø±ÙŠØ¨Ø©</h3>
        <p class="text-gray-600 text-sm md:text-base">ØªØµÙØ­ ÙˆØ§Ø·Ù„Ø¨ Ù…Ù† Ù…ØªØ§Ø¬Ø± Ø­ÙŠ ØªÙ†Ø§Ù„ Ø¨Ø³Ù‡ÙˆÙ„Ø©.</p>
      </div>
      <div class="bg-white p-6 rounded-2xl shadow-md hover:shadow-lg transition transform hover:-translate-y-1">
        <h3 class="text-xl font-semibold text-gray-800 mb-2">ğŸšš Ù…Ù†Ø§Ø¯ÙŠØ¨ Ù…Ø­Ù„ÙŠÙˆÙ†</h3>
        <p class="text-gray-600 text-sm md:text-base">ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹ ÙˆØ¢Ù…Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­ÙŠ.</p>
      </div>
      <div class="bg-white p-6 rounded-2xl shadow-md hover:shadow-lg transition transform hover:-translate-y-1">
        <h3 class="text-xl font-semibold text-gray-800 mb-2">ğŸ“¢ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ù…ÙŠØ²Ø©</h3>
        <p class="text-gray-600 text-sm md:text-base">Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø®ØµØµØ© Ù„Ø³ÙƒØ§Ù† Ø§Ù„Ø­ÙŠ ÙÙ‚Ø·.</p>
      </div>
    </div>
  </section>

  <!-- ğŸ“¢ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª -->
  {% if ads %}
  <section class="max-w-7xl mx-auto px-4 sm:px-6 py-8 md:py-12">
    <h2 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-6 md:mb-8">ğŸ“¢ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø­ÙŠ</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
      {% for ad in ads %}
      <div onclick="openAdModal({{ ad.id }})"
           class="cursor-pointer bg-white rounded-xl shadow-md hover:shadow-lg transition overflow-hidden flex flex-col group h-full">
        <div class="relative w-full aspect-[4/3] bg-gray-100 overflow-hidden">
          {% if ad.image %}
          <img src="{{ ad.image.url }}" alt="{{ ad.title }}"
               class="object-cover w-full h-full group-hover:scale-105 transition-transform duration-300"
               loading="lazy" />
          {% else %}
          <div class="w-full h-full flex items-center justify-center text-gray-500">
            <i class="fas fa-image text-4xl opacity-30"></i>
          </div>
          {% endif %}
        </div>
        <div class="p-4 flex flex-col flex-grow">
          <h3 class="text-lg font-bold text-gray-800 mb-2 line-clamp-2">{{ ad.title }}</h3>
          <p class="text-gray-600 text-sm line-clamp-2 mb-4">{{ ad.text }}</p>
          <button class="mt-auto w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition">
            Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
          </button>
        </div>
      </div>

      <!-- Modal Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† -->
      <div id="ad-modal-{{ ad.id }}"
           class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4">
        <div onclick="event.stopPropagation()"
             class="bg-white rounded-xl max-w-xl w-full p-6 relative animate-fade-in max-h-[90vh] overflow-y-auto">
          <button onclick="closeAdModal({{ ad.id }})"
                  class="absolute top-3 left-3 text-gray-400 hover:text-red-600 text-2xl transition">&times;</button>
          {% if ad.image %}
          <img src="{{ ad.image.url }}" alt="{{ ad.title }}"
               class="rounded-lg mb-4 w-full max-h-[50vh] object-contain mx-auto" />
          {% endif %}
          <h3 class="text-xl font-bold text-gray-800 mb-2">{{ ad.title }}</h3>
          <div class="prose prose-sm max-w-none text-gray-600 mb-4 whitespace-pre-line">{{ ad.text }}</div>
          {% if ad.link %}
          <a href="{{ ad.link }}" target="_blank" rel="noopener noreferrer"
             class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition">
            <i class="fas fa-external-link-alt mr-2"></i>Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø±Ø§Ø¨Ø·
          </a>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}

</div>

<!-- âœ… Scripts -->
<script>
  // âœ… Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¯Ø§Ø¦Ù…Ù‹Ø§
  window.addEventListener('load', () => {
    const popup = document.getElementById('welcome-popup');
    if (popup) {
      popup.classList.remove('hidden');
      setTimeout(() => {
        popup.classList.add('hidden');
      }, 10000);
    }
  });

  function closeWelcomePopup() {
    const popup = document.getElementById('welcome-popup');
    if (popup) popup.classList.add('hidden');
  }

  function openAdModal(id) {
    document.getElementById(`ad-modal-${id}`).classList.remove("hidden");
    document.body.style.overflow = "hidden";
  }

  function closeAdModal(id) {
    document.getElementById(`ad-modal-${id}`).classList.add("hidden");
    document.body.style.overflow = "auto";
  }

  document.addEventListener("click", function (e) {
    const modals = document.querySelectorAll('[id^="ad-modal-"]');
    modals.forEach((modal) => {
      if (!modal.classList.contains("hidden") && e.target === modal) {
        modal.classList.add("hidden");
        document.body.style.overflow = "auto";
      }
    });
  });
</script>

<style>
  .animate-fade-in {
    animation: fadeIn 0.3s ease-out forwards;
  }

  .animate-fade-up {
    animation: fadeUp 0.5s ease-out forwards;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .prose { line-height: 1.75; }
  .prose p { margin-bottom: 1em; }
</style>
{% endblock %}
