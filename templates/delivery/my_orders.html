{% extends "core/base.html" %}
{% block title %}Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠØ©{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto bg-white rounded-xl shadow p-6 mb-10">
  <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>

  {% if messages %}
    <div class="mb-4 space-y-2">
      {% for message in messages %}
        <div class="bg-green-100 text-green-800 px-4 py-2 rounded shadow text-sm">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% for order in orders %}
    <div class="border border-gray-200 rounded-xl shadow-sm p-5 mb-6 bg-gray-50 hover:bg-gray-100 transition-all duration-200">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700 leading-relaxed">

        <!-- ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
        <div>
          <p><strong>ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> {{ order.customer_name }}</p>
          {% if order.customer_phone %}
            <p class="text-gray-600 text-xs mt-1">{{ order.customer_phone }}</p>
          {% endif %}
        </div>

        <p><strong>ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº:</strong> {{ order.invoice_amount|default:"-" }} Ø±ÙŠØ§Ù„</p>
        <p><strong>ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:</strong> {{ order.details }}</p>

        <!-- ğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
        <p class="flex items-center gap-1">
          <strong>ğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong>
          {% if order.customer_latitude and order.customer_longitude %}
            <a href="https://www.google.com/maps?q={{ order.customer_latitude }},{{ order.customer_longitude }}"
               target="_blank" class="text-blue-600 hover:underline">
              ğŸ”— Ø§Ù†ØªÙ‚Ù„
            </a>
          {% else %}
            <span class="text-gray-500">ØºÙŠØ± Ù…ØªÙˆÙØ±</span>
          {% endif %}
        </p>

        <!-- ğŸ“Œ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…ØªØ¬Ø± -->
        <p class="flex items-center gap-1">
          <strong>ğŸ“Œ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…ØªØ¬Ø±:</strong>
          {% if order.store_latitude and order.store_longitude %}
            <a href="https://www.google.com/maps?q={{ order.store_latitude }},{{ order.store_longitude }}"
               target="_blank" class="text-blue-600 hover:underline">
              ğŸ”— Ø§Ù†ØªÙ‚Ù„
            </a>
          {% else %}
            <span class="text-gray-500">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
          {% endif %}
        </p>

        <!-- ğŸª Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± -->
        <p>
          <strong>ğŸª Ø§Ù„Ù…ØªØ¬Ø±:</strong>
          {{ order.store.name|default:"Ø§Ø³Ù… ØºÙŠØ± Ù…ØªÙˆÙØ±" }}
          {% if order.store.user.username %}
            <span class="text-gray-600 text-xs">({{ order.store.user.username }})</span>
          {% endif %}
        </p>
      </div>

      <!-- âœ… Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
      <div class="flex flex-wrap gap-3 mt-5">

        <!-- ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ -->
        <a href="{% url 'complete_order' order.id %}"
           class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm transition">
          âœ… ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„
        </a>

        <!-- Ø§ØªØµØ§Ù„ + ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ø±Ø³Ø§Ù„Ø© Ù…Ø®ØµØµØ© -->
        {% if order.customer_phone %}
          <a href="tel:{{ order.customer_phone }}"
             class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition">
            ğŸ“ Ø§ØªØµØ§Ù„
          </a>

          {% with order.customer_phone as raw_phone %}
            {% if raw_phone|slice:":1" == "0" %}
              {% with "966"|add:raw_phone|slice:"1:" as whatsapp_number %}
                {% with 'Ø·Ù„Ø¨Ùƒ Ù…Ù† Ù…ØªØ¬Ø± ' as pre %}
                  {% with pre|add:order.store.name|add:' ÙÙŠ Ø·Ø±ÙŠÙ‚Ù‡ Ø¥Ù„ÙŠÙƒ ğŸšš' as message %}
                    <a href="https://wa.me/{{ whatsapp_number }}?text={{ message|urlencode }}"
                       target="_blank"
                       class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm transition">
                      ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨
                    </a>
                  {% endwith %}
                {% endwith %}
              {% endwith %}
            {% else %}
              {% with 'Ø·Ù„Ø¨Ùƒ Ù…Ù† Ù…ØªØ¬Ø± ' as pre %}
                {% with pre|add:order.store.name|add:' ÙÙŠ Ø·Ø±ÙŠÙ‚Ù‡ Ø¥Ù„ÙŠÙƒ ğŸšš' as message %}
                  <a href="https://wa.me/{{ raw_phone }}?text={{ message|urlencode }}"
                     target="_blank"
                     class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm transition">
                    ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨
                  </a>
                {% endwith %}
              {% endwith %}
            {% endif %}
          {% endwith %}
        {% endif %}

        <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
        {% if order.customer_latitude and order.customer_longitude and order.store_latitude and order.store_longitude %}
          <button onclick="showMap({{ order.id }})"
                  class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm transition">
            ğŸ—ºï¸ Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
          </button>
        {% else %}
          <span class="text-yellow-600 text-sm mt-2">
            âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø© (Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù†Ø§Ù‚ØµØ©)
          </span>
        {% endif %}
      </div>
    </div>
  {% empty %}
    <p class="text-center text-gray-500 mt-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹ Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„.</p>
  {% endfor %}
</div>
{% endblock %}
