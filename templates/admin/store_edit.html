{% extends "core/base.html" %}
{% load widget_tweaks %}

{% block title %}ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto bg-white rounded-xl shadow p-6">
  <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h2>

  <form method="POST" class="space-y-5">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <!-- ğŸª Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± -->
    <div>
      <label class="block mb-1 text-sm text-gray-700">ğŸª Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±</label>
      {{ form.name|add_class:"w-full border rounded px-3 py-2" }}
      {{ form.name.errors }}
    </div>

    <!-- ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ -->
    <div>
      <label class="block mb-1 text-sm text-gray-700">ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
      {{ form.phone|add_class:"w-full border rounded px-3 py-2" }}
      {{ form.phone.errors }}
    </div>

    <!-- ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ -->
    <div>
      <label class="block mb-1 text-sm text-gray-700">ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</label>
      {{ form.address|add_class:"w-full border rounded px-3 py-2" }}
      {{ form.address.errors }}
    </div>

    <!-- ğŸ·ï¸ Ù†ÙˆØ¹ Ø§Ù„Ù…ØªØ¬Ø± -->
    <div>
      <label class="block mb-1 text-sm text-gray-700">ğŸ·ï¸ Ù†ÙˆØ¹ Ø§Ù„Ù…ØªØ¬Ø±</label>
      {{ form.store_type|add_class:"w-full border rounded px-3 py-2" }}
      {{ form.store_type.errors }}
    </div>

    <!-- ğŸ—ºï¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
    <div>
      <label class="block mb-1 text-sm text-gray-700">ğŸ—ºï¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</label>
      <div id="map" class="h-64 rounded border shadow my-2"></div>
    </div>

    {{ form.latitude.as_hidden }}
    {{ form.longitude.as_hidden }}

    <div class="text-sm text-gray-600">
      ğŸ“Œ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©:
      <span id="lat-display">{{ form.instance.latitude|default:"--" }}</span>,
      <span id="lng-display">{{ form.instance.longitude|default:"--" }}</span>
    </div>

    <!-- ğŸ“¦ Ø§Ù„Ù…ØªØ¬Ø± Ù…ØªØ§Ø­ -->
    <div class="flex items-center mt-4">
      {{ form.is_available|add_class:"mr-2 h-4 w-4" }}
      <label class="text-sm text-gray-700">ğŸ“¦ Ø§Ù„Ù…ØªØ¬Ø± Ù…ØªØ§Ø­ Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</label>
    </div>

    <!-- âœ… Ø£Ø²Ø±Ø§Ø± -->
    <div class="flex gap-4 mt-6">
      <button type="submit"
              class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded font-medium transition">
        ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
      </button>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_scripts %}
<!-- âœ… Leaflet map -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const latInput = document.querySelector('[name="latitude"]');
    const lngInput = document.querySelector('[name="longitude"]');
    const latDisplay = document.getElementById("lat-display");
    const lngDisplay = document.getElementById("lng-display");

    const lat = parseFloat(latInput.value) || 24.7136;
    const lng = parseFloat(lngInput.value) || 46.6753;

    const map = L.map("map").setView([lat, lng], 14);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const marker = L.marker([lat, lng], { draggable: true }).addTo(map);

    marker.on("dragend", function () {
      const { lat, lng } = marker.getLatLng();
      latInput.value = lat.toFixed(6);
      lngInput.value = lng.toFixed(6);
      latDisplay.textContent = lat.toFixed(6);
      lngDisplay.textContent = lng.toFixed(6);
    });
  });
</script>
{% endblock %}
